<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Event-Driven on Tech Nick</title>
    <link>https://blair55.github.io/tags/event-driven/</link>
    <description>Recent content in Event-Driven on Tech Nick</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Tue, 13 Apr 2021 00:42:14 +0100</lastBuildDate>
    
        <atom:link href="https://blair55.github.io/tags/event-driven/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Parallelising Heterogeneous Async Calls</title>
      <link>https://blair55.github.io/blog/parallel-hetero-async/</link>
      <pubDate>Thu, 04 Dec 2025 01:00:00 +0000</pubDate>
      
      <guid>https://blair55.github.io/blog/parallel-hetero-async/</guid>
      <description>&lt;p&gt;This is a post for the &lt;a href=&#34;https://sergeytihon.com/2025/11/03/f-advent-calendar-in-english-2025/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;FSharp Advent Calendar 2025&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A particular feature of F# 10 got me thinking about approaches to parallelism, past and present.&lt;/p&gt;
&lt;h3 id=&#34;asyncparallel&#34;&gt;Async.Parallel&lt;/h3&gt;
&lt;p&gt;This system library function is built for orchestrating async calls with &lt;em&gt;homogenous&lt;/em&gt; return types. It has an overload that permits controlling the degree of parallelism.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;member&lt;/span&gt; Parallel&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   computations&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; seq&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;Async&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;T&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Async&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;T array&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It&amp;rsquo;s great for situations where we want to make multiple calls to the same api endpoint with different arguments - because each call expects the same response, we end up with a collection of the response type when all the calls are complete. And given the calls are made in parallel, we might only have to wait as long as the longest call.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; fetchData i&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Async&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; it&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt; array &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; 1&lt;span style=&#34;color:#81a1c1&#34;&gt;..&lt;/span&gt;10 &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map fetchData
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;Parallel
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;RunSynchronously
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;hetorogenous-concurrency&#34;&gt;Hetorogenous Concurrency&lt;/h3&gt;
&lt;p&gt;But what about when we want to make multiple calls to different endpoints? i.e. We&amp;rsquo;re expecting different looking data. Let&amp;rsquo;s say we have to load some data for a dashboard when a user logs in. We have three calls to make that return &lt;em&gt;heterogeneous&lt;/em&gt; data:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getUserDetails userId&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Async&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;UserDetails&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;...&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getNotifications userId&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Async&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;Notice List&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;...&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getActivePromotion &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Async&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;Promotion Option&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;...&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;DashboardData&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; UserDetails &lt;span style=&#34;color:#81a1c1&#34;&gt;*&lt;/span&gt; Notice List &lt;span style=&#34;color:#81a1c1&#34;&gt;*&lt;/span&gt; Promotion Option
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We could &lt;em&gt;&lt;strong&gt;unify&lt;/strong&gt;&lt;/em&gt; the return types in order to leverage &lt;code&gt;Async.Parallel&lt;/code&gt;. There&amp;rsquo;s no good reason to use this approach anymore, though I have used it in the past!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// Unifying type
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;DashboardAsync&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; GetUserDetails &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; UserDetails
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; GetNotifications &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; Notice List
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; GetActivePromotion &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; Promotion Option
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getDashboardData userId &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Async&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;DashboardData&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// construct a list of homogeneous async calls from heterogeneous ones
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; getUserDetails userId &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map GetUserDetails
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    getNotifications userId &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map GetNotifications
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    getActivePromotion &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map GetActivePromotion
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;Parallel
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;results&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; DashboardAsync array&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// start with empty placeholders then fold over the results to collect
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;((&lt;/span&gt;None&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; None&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; None&lt;span style=&#34;color:#81a1c1&#34;&gt;),&lt;/span&gt; results&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;||&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Array&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;fold &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;d&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; p&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;function&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; GetUserDetails details &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Some details&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; p
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; GetNotifications notices &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; d&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; Some notices&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; p
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; GetActivePromotion promo &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; d&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; Some promo&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// verify expected data
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;function&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Some details&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; Some notifications&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; Some promotion &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            details&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; notifications&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; promotion
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; failwith &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Missing data&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; map f x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; y &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; f y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This approach achieves making concurrent calls, but we can&amp;rsquo;t ignore the downsides:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;it requires an extra type and a helper function&lt;/li&gt;
&lt;li&gt;it requires a fold function costing mental overhead&lt;/li&gt;
&lt;li&gt;it requires extra logic to check all the calls have completed&lt;/li&gt;
&lt;li&gt;it&amp;rsquo;s fiddly to add or remove calls&lt;/li&gt;
&lt;li&gt;compiler support is lost / it might throw an exception!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To illustrate the point about compiler support: the constructed list of &lt;code&gt;DashboardAsync&lt;/code&gt;s could become out-of-sync with the verification logic: we could, for example, accidentally omit the &lt;code&gt;getNotifications&lt;/code&gt; call.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; getUserDetails userId &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map GetUserDetails
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// getNotifications userId |&amp;gt; Async.map GetNotifications
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;&lt;/span&gt;    getActivePromotion &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map GetActivePromotion
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The code would compile happily but throw an exception at runtime - very un-F# like! We could mitigate by using the &lt;code&gt;Result&lt;/code&gt; type to model the verification of the outcome (and also the async calls i.e. &lt;code&gt;AsyncResult&lt;/code&gt;) but it would add weight to the solution.&lt;/p&gt;
&lt;h3 id=&#34;asyncstartchild&#34;&gt;Async.StartChild&lt;/h3&gt;
&lt;p&gt;The obvious improvement here is to kick off the calls with &lt;code&gt;Async.StartChild&lt;/code&gt;. Parallelism achieved with none of the downsides from the previous approach. However, StartChild function returns an &lt;code&gt;Async&amp;lt;Async&amp;lt;&#39;T&amp;gt;&amp;gt;&lt;/code&gt;, so we have to use another &lt;code&gt;let!&lt;/code&gt; to get to the result.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getDashboardData userId &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Async&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;DashboardData&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; detailsAsync &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; getUserDetails userId &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;StartChild
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; notificationsAsync &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; getNotifications userId &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;StartChild
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; promotionAsync &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; getActivePromotion &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;StartChild
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; details &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; detailsAsync
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; notifications &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; notificationsAsync
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; promotion &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; promotionAsync
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; details&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; notifications&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; promotion
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;f-10&#34;&gt;F# 10&lt;/h3&gt;
&lt;p&gt;The introduction of &lt;a href=&#34;https://learn.microsoft.com/en-us/dotnet/fsharp/whats-new/fsharp-10#support-for-and-in-task-expressions&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;support for &lt;code&gt;and!&lt;/code&gt; in &lt;code&gt;task&lt;/code&gt; expressions&lt;/a&gt; in F# 10 brings the solution in its final form: Concurrent calls with almost no overhead. Map the result back to Async with &lt;code&gt;Async.AwaitTask&lt;/code&gt; if required.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// tasks awaited concurrently with and! in F# 10
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getDashboardData userId &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Task&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;DashboardData&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; task &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; details &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; getUserDetails userId &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;StartAsTask
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; notifications &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; getNotifications userId &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;StartAsTask
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; promotion &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; getActivePromotion &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;StartAsTask
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; details&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; notifications&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; promotion
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>RightResult Write Up</title>
      <link>https://blair55.github.io/blog/rightresult-write-up/</link>
      <pubDate>Tue, 13 Apr 2021 00:42:14 +0100</pubDate>
      
      <guid>https://blair55.github.io/blog/rightresult-write-up/</guid>
      <description>&lt;hr&gt;
&lt;h2 id=&#34;about-the-design&#34;&gt;About the design&lt;/h2&gt;
&lt;hr&gt;
&lt;h3 id=&#34;what-problem-inspired-this-work&#34;&gt;What problem inspired this work?&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://rightresu.lt&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;RightResult&lt;/a&gt; is the SAAS incarnation of a game my friend would coordinate via emails and a spreadsheet.&lt;/p&gt;
&lt;p&gt;Each week, he would email game members requesting predictions for the weekend&amp;rsquo;s English Premier League fixtures. Predictions and fixture results were entered into a spreadsheet. The scores would be tallied-up and communicated back to members. The winner was who had predicted most accurately.&lt;/p&gt;
&lt;p&gt;I built a product to ease the coordination burden and improve the experience for members. It also serves as a technical laboratory with real challenges.&lt;/p&gt;
&lt;p&gt;Emphasized links refer to &lt;em&gt;&lt;a href=&#34;https://github.com/blair55/rightresult&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;source code&lt;/a&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;what-is-your-solutions-approach&#34;&gt;What is your solution&amp;rsquo;s approach?&lt;/h3&gt;
&lt;p&gt;RightResult automates-away most of the game coordination responsibilities. The application sources the weekly fixtures and follows up with the results. This reduces the human effort and improves reliability.&lt;/p&gt;
&lt;p&gt;Members identify using a social media account. Once logged in, members can submit predictions for open fixtures. A prediction consists of the number of goals scored for both teams in the fixture. After a fixture begins it is closed for predictions. Predictions are compared to the result as soon as the fixture ends. Performance metrics are calculated and immediately made available for review in the application.&lt;/p&gt;
&lt;p&gt;The game awards 3 points for predicting the correct number of goals scored by both teams. The number of goals determines the fixture outcome: home win, draw, or away win. The game awards 1 point for a correct outcome as inferred from the prediction. For example, a 1-0 prediction for a 2-0 fixture result yields 1 point because the outcome was a home win. Each player can &amp;lsquo;double down&amp;rsquo; on one fixture per week to double the awarded points.&lt;/p&gt;
&lt;p&gt;All members are included in the Global League. Members are able to create private leagues and invite friends to join. All leagues compare members&amp;rsquo; performance using a league table. Historic views of league tables make performance traceable over the course of the football season. This means it is practical to identify present and historic winners. The matrix feature offers a holistic view of league members&amp;rsquo; predictions per week.&lt;/p&gt;
&lt;p&gt;The application supports push notifications on supported platforms. Subscribed members are informed when new fixtures are added. My friend continues to announce winners by email which preserves a sense of community.&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;how-is-your-solution-used&#34;&gt;How is your solution used?&lt;/h3&gt;
&lt;p&gt;Please enjoy the &lt;a href=&#34;https://www.loom.com/share/512a0cd2f3ce4a4c9ba2bd4e5b6b6784&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;walkthrough video&lt;/a&gt;!&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;what-forces-were-you-designing-for&#34;&gt;What forces were you designing for?&lt;/h3&gt;
&lt;p&gt;The priorities were clear because my friends and I were members of the original game. The driving force was the desire to reduce burden and modernise the experience. There was little doubt that a web-based product would bring these benefits. As I was willing to pay development costs with my own time, there was no downside to consider.&lt;/p&gt;
&lt;p&gt;I used the Yeoman scaffolding framework to build the first iteration of RightResult. The frontend was implemented with Angular and raw JS. I optimised for speed of delivery and not longevity or maintainability. This satisfied the need to produce an MVP in time for the new football season.&lt;/p&gt;
&lt;p&gt;The first version only persisted predictions and results data. League tables were not available at rest. To view a league table, the application loaded all the data to calculate the awarded points. The response time would deteriorate as the season progressed due to this lazy-loaded delivery. The poor performance drew complaints from frustrated members.&lt;/p&gt;
&lt;p&gt;The latest iteration improves on maintainability with the choice to use F#. The power of the type system is leveraged throughout the stack. I have confidence in changes even when the domain is not fresh in my mind. The response time remains low throughout the season because each view is eagerly-evaluated. This is discussed further in the architecture section.&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;what-alternatives-did-you-consider&#34;&gt;What alternatives did you consider?&lt;/h3&gt;
&lt;p&gt;I was curious about graph databases. The second iteration of RightResult allowed me to solve a real problem with graph technology. I used &lt;a href=&#34;https://neo4j.com/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;Neo4j&lt;/a&gt; to persist relationships between members and private leagues. I took the time to up-skill and satisfy my curiosity. On reflection, the choice has not added significant value to the product. Although, there is value in the experience gained learning any new technology.&lt;/p&gt;
&lt;p&gt;Graph databases are powerful in a relationship-rich domain. The potential to gain insight grows with the number of distinct relationship types. The member/league relationship is naturally shallow so there is little explorative potential. A simpler alternative would have been a relational database like MySql or Postgres. The time spent up-skilling represents lost opportunity-cost.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;about-the-implementation&#34;&gt;About the implementation&lt;/h2&gt;
&lt;hr&gt;
&lt;h3 id=&#34;how-is-your-solution-architected&#34;&gt;How is your solution architected?&lt;/h3&gt;
&lt;p&gt;At the code-level, RightResult is based on the &lt;a href=&#34;https://safe-stack.github.io/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;SAFE stack&lt;/a&gt; application model. This means F# is used on the frontend and backend. I used &lt;a href=&#34;https://zaid-ajaj.github.io/Fable.Remoting/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;Fable.Remoting&lt;/a&gt; to share a &lt;em&gt;&lt;a href=&#34;https://github.com/blair55/rightresult/blob/master/src/Server/Events.fs&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;domain model&lt;/a&gt;&lt;/em&gt; across the both client and server applications. This maximises compiler support.&lt;/p&gt;
&lt;p&gt;Both client and server are event-driven applications, though the implementations differ.&lt;/p&gt;
&lt;p&gt;The client application uses the &lt;a href=&#34;https://elmish.github.io/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;Elmish&lt;/a&gt; framework. This delivers the design pattern at the core of the Elm programming language. User interactions are modelled as commands that may produce events. Events are the only way that application state can be changed. All possible events are defined with a &lt;em&gt;&lt;a href=&#34;https://github.com/blair55/rightresult/blob/master/src/Client/Areas/Fixtures/OmniFixtures.fs/#L42-L55&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;union type&lt;/a&gt;&lt;/em&gt; so can be evaluated with a pattern match expression.&lt;/p&gt;
&lt;p&gt;An example input command is &amp;lsquo;Decrement Score&amp;rsquo;. The output would be a &amp;lsquo;Score Decremented&amp;rsquo; event if the state holds a score greater than zero. Otherwise, no events are returned. This highlights when input is validated, and is summarised by the following signature.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;(command * state) -&amp;gt; event list
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Next, the elmish framework calls a &lt;em&gt;&lt;a href=&#34;https://github.com/blair55/rightresult/blob/master/src/Client/Areas/Leagues/LeagueHistory.fs/#L145-L157&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;function&lt;/a&gt;&lt;/em&gt; to apply the state change caused by the event. The &amp;lsquo;Score Decremented&amp;rsquo; event will cause the score in the application state to reduce by one. The output of the function is the updated application state.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;(event * state) -&amp;gt; state
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The state is used to render the view using a &lt;em&gt;&lt;a href=&#34;https://github.com/blair55/rightresult/blob/master/src/Client/Areas/Leagues/CreateLeague.fs/#L43-L61&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;function&lt;/a&gt;&lt;/em&gt; provided to the elmish framework. This continuous, iterative application of event-to-state constitutes the &lt;a href=&#34;https://guide.elm-lang.org/architecture/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;Model View Update pattern&lt;/a&gt; (MVU). It can be thought of as the &lt;a href=&#34;https://fsharp.github.io/fsharp-core-docs/reference/fsharp-collections-listmodule.html#fold&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;fold function&lt;/a&gt; at the application-level. Each step is pure, causing no side-effects and requiring &lt;a href=&#34;https://henrikeichenhardt.blogspot.com/2013/06/why-shared-mutable-state-is-root-of-all.html&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;no shared state&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The event-driven aspect of the server application is provided by &lt;a href=&#34;https://www.eventstore.com/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;Event Store&lt;/a&gt;. This is a database designed for storing and replaying events. As with the client, input commands received by the server are validated and may produce events. Events committed to Event Store are immutable and persisted permanently. The application is also subscribed to the database such that new events can be acted on.&lt;/p&gt;
&lt;p&gt;Like the client, the server application reacts to &lt;em&gt;&lt;a href=&#34;https://github.com/blair55/rightresult/blob/master/src/Server/Events.fs&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;events&lt;/a&gt;&lt;/em&gt; by updating its state. Application state is managed with two mutable storage approaches. The first uses Neo4j to persist the relationships between members and leagues. The second uses in-memory &lt;a href=&#34;https://fsharp.github.io/fsharp-core-docs/reference/fsharp-collections-mapmodule.html&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;maps&lt;/a&gt; to hold league tables and members&amp;rsquo; performance metrics. When the server application starts it destroys the data stored in Neo4j. Naturally, the in-memory storage is empty on start up. The application asks the database to replay all events in-order from the beginning. Each event is handled according to application logic and applied to the current state. The output is captured in mutable storage and so rehydrates application state. Once the application has replayed all existing events it remains subscribed for new ones.&lt;/p&gt;
&lt;p&gt;An example of a server application event is &amp;lsquo;Fixture Classified&amp;rsquo;. This is when the application sources the result of a fixture. The application reacts to this event by comparing the result to the predictions. The score for each members&amp;rsquo; prediction is applied to each league the member belongs to. League tables are updated in-memory. Members&amp;rsquo; performance metrics are also recalculated and captured. In this way, all tabular views in the application are eagerly-evaluated. The data is always available at rest and ready to serve on request. This improves response time as mentioned in the quality attributes section.&lt;/p&gt;
&lt;p&gt;Traffic volume is low enough that the entire application can be hosted on a single Digital Ocean &lt;a href=&#34;https://docs.digitalocean.com/products/droplets/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;droplet&lt;/a&gt; (virtual machine). Nginx hosts the TLS certificate. The server application, proxy, and database components are provisioned using &lt;a href=&#34;https://docs.docker.com/compose/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;docker-compose&lt;/a&gt;. The Event Store container is configured with a volume so events are persisted to disk. The diagram below is scoped to the component level of architecture.&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34;  src=&#34;architecture.png&#34;
        alt=&#34;architecture&#34;/&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;whats-a-compromise-you-had-to-make&#34;&gt;What&amp;rsquo;s a compromise you had to make?&lt;/h3&gt;
&lt;p&gt;The single-instance hosting approach is one giant trade-off. The application will not scale if a traffic spike occurred. However, rearchitecting for scalability would be expensive. The risk of increased traffic is low, and the audience is not globally distributed. This is therefore an acceptable compromise for now.&lt;/p&gt;
&lt;p&gt;Background-tasks such as result fetching are coupled to the web application. Tasks are scheduled using a &lt;em&gt;&lt;a href=&#34;https://github.com/blair55/rightresult/blob/master/src/Server/Server.fs/#L510-L514&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;timeout&lt;/a&gt;&lt;/em&gt; running inside a &lt;a href=&#34;https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-5.0&amp;amp;tabs=visual-studio&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;hosted service&lt;/a&gt;. A preferable solution would be to break-out the background tasks into containers. They would operate at the same level, and have a sibling relationship with the web application rather than a parent/child one. Independently managed tasks would decouple the concepts and reduce resource contention. This code-level compromise saved development time and keeps the packaging process simple.&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;how-would-you-spend-a-week-developing-further&#34;&gt;How would you spend a week developing further?&lt;/h3&gt;
&lt;p&gt;I would add value by developing game features. A live-score feature would supplement the UI for in-play fixtures. Members have also suggested richer rules to support more ways to award points for each fixture. The event stream could be replayed against the new rules to observe the effect on historic winners.&lt;/p&gt;
&lt;p&gt;I would like to further &lt;em&gt;gamify&lt;/em&gt; the product by celebrating achievements. Historic winners could be decorated with badges. This could also be applied retrospectively by replaying events. The challenge is to curate a suitable set of awards.&lt;/p&gt;
&lt;p&gt;I would like to automate the &lt;a href=&#34;https://letsencrypt.org/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt; certificate renewal to reduce operational overhead. The next iteration of RightResult will be built using serverless technology such as &lt;a href=&#34;https://aws.amazon.com/lambda/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;AWS lambda&lt;/a&gt;. This will further reduce running costs and increase scalability.&lt;/p&gt;
&lt;p&gt;If the question was &amp;ldquo;what would you do with a team of engineers?&amp;rdquo; then my priorities would be different. The &lt;em&gt;&lt;a href=&#34;https://github.com/blair55/rightresult/blob/master/.github/workflows/publish.yml&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;continuous integration&lt;/a&gt;&lt;/em&gt; pipeline would be enhanced with more tests. Effort would be invested in developer workflow to improve productivity. Test-data generation and temporary stack support would aid issue-reproduction.&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;what-would-you-have-done-with-a-week-less&#34;&gt;What would you have done with a week less?&lt;/h3&gt;
&lt;p&gt;Push notifications were most recently added to the application. This non-core feature was not required for launch.&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;what-would-change-about-the-delivery&#34;&gt;What would change about the delivery?&lt;/h3&gt;
&lt;p&gt;The fundamental approach would not change significantly. Core features and Job(s)-To-Be-Done would be prioritised for the MVP. Further features would be delivered incrementally. Feature toggling could be applied on a per-member basis to get feedback with minimal risk.&lt;/p&gt;
&lt;p&gt;Member-led explorative testing before the season begins would help polish the rough edges. Load and performance tests would define the bounds of the application. Knowing the threshold means I can make an informed hosting choice rather than hoping for the best.&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;how-did-you-get-feedback&#34;&gt;How did you get feedback?&lt;/h3&gt;
&lt;p&gt;Many of my friends are members of the game. We have candid conversations about the suitability of existing features and the priority of new ones. Qualitative feedback from beyond my circle of friends comes via social media. The email channel also receives suggestions and bug reports. I experimented with a feedback form in the application but gained little insight.&lt;/p&gt;
&lt;p&gt;The Neo4j database allows for quantitive analysis. However, the answers to questions like &amp;ldquo;how many members are in more than one league with the same member&amp;rdquo; are worth little with a low sample-size. Off-the-shelf analytics platforms would be excessive solutions for the same reason. I will think critically about the questions I want to answer when the product matures. The strategic objectives and velocity could be measured empirically. For now, it remains a hobby that helps to bind a group of friends.&lt;/p&gt;
&lt;hr&gt;
</description>
    </item>
    
    <item>
      <title>Integration testing a locally hosted serverless project</title>
      <link>https://blair55.github.io/blog/serverless-integration-testing/</link>
      <pubDate>Sun, 10 May 2020 11:04:23 +0100</pubDate>
      
      <guid>https://blair55.github.io/blog/serverless-integration-testing/</guid>
      <description>&lt;h2 id=&#34;strategy&#34;&gt;Strategy&lt;/h2&gt;
&lt;p&gt;There are many choices for running integration/functional/e2e tests with a serverless project.
There are two main modes of operation for integration testing.
The first is cloud-hosted infrastructure in which a temporary copy of the stack is deployed
and the intregration tests are pointed at the resources.
This has the benefit of increasing the scope of the integration tests to include
permissions and configuration.
The door is also open for security or load testing, as the target environment is almost
identical to what production will be.
The downside of testing against cloud hosted infrastructure is that you introduce a network
dependency into your stack. Your internet connection must be reliable, and your cloud
host must be operational for your tests to succeed.
Furthermore, the overhead in creating and tearing down stacks can be wearisom in an otherwise
fast-paced development feedback loop.&lt;/p&gt;
&lt;p&gt;This article will focus on the second mode of operation:
integration testing against a locally hosted stack.
A local stack tends to be faster to setup and work with.
It has no network dependency at runtime so reduces the scope of the debugging exercise.
Running integration tests against a local stack is also slightly easier to repeat in
a CI environment, without the requirement of sharing cloud credentials.
Lastly, local environments can never be shared with other developers.
The temptation for cloud hosted infrastructure is to spin up a semi-permanent stack
that is shared by a team. This can cause problems when two developers are working on project
at the same time. Extra effort is required to enforce a one-cloud-stack-per-developer policy.&lt;/p&gt;
&lt;p&gt;Its important to note that these options are not mutually exclusive.
There is value in exercising tests against both a locally-hosted and cloud-hosted
stack if you feel the extra effort is worth it. For example, using a local stack during
development whilst only engaging cloud resources during the CI pipeline would make for a
reasonable blend of strategies.&lt;/p&gt;
&lt;h2 id=&#34;serverless-plugins&#34;&gt;Serverless plugins&lt;/h2&gt;
&lt;p&gt;The Serverles Framework ecosystem of plugins provides a starting point for spinning up
local infrastructure. A suite of &amp;lsquo;offline&amp;rsquo; plugins exist, each one targeted at a specific
aws service. A plugin, once installed, will start the aws service on a local port, and
integrate with your serverless file in order to reproduce the specifc resources.&lt;/p&gt;
&lt;p&gt;For example, the &lt;code&gt;serverless-dynamodb-local&lt;/code&gt; plugin will start dynamodb on port 8000.
It will also inspect your serverless file &lt;code&gt;Resources&lt;/code&gt; section and create any tables
as specified. Enforcing the parameterised table name, attributes and key schema.
Plugins for most popular aws services &lt;a href=&#34;https://github.com/topics/serverless-offline&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;exist&lt;/a&gt;,
including S3, SQS, SNS &amp;amp; Kinesis.&lt;/p&gt;
&lt;h2 id=&#34;dude-wheres-my-docker-compose&#34;&gt;Dude, where&amp;rsquo;s my docker-compose?&lt;/h2&gt;
&lt;p&gt;Another solution for spinning up local infrastructure is &lt;code&gt;docker-compose&lt;/code&gt;.
I&amp;rsquo;m a big fan of this product and have used it extensively in other solutions.
Docker-compose has the benefit of not requiring any further dependencies in
order to run the desired services. For example, a requirement to run the
&lt;code&gt;serverless-dynamodb-local&lt;/code&gt; plugin is that the Java-JRE must be installed
not only locally but also in your CI environment. Different plugins may have
different dependencies, but with docker-compose the off-the-shelf image for any
tool is completely self-contained.&lt;/p&gt;
&lt;p&gt;However, I think the major benefit of using serverless plugins is the shared
definition of specific resources. With docker-compose, I would need to express
the definition of a dynanmoDB table again in a different format. This is
duplication of code and an added maintenance burden.&lt;/p&gt;
&lt;p&gt;Furthermore, docker-compose is a something of sledge-hammer. Whilst researching
the following approach I wanted to see if I could reproduce a docker-compose-esque
workflow just using npm packages. Maintaining a single, centralized configuration
file in &lt;code&gt;package.json&lt;/code&gt; and reducing the mental overhead. The aim is to provide
the developer with a single command that will kick off dependencies before running
the tests.&lt;/p&gt;
&lt;h2 id=&#34;npm-packages&#34;&gt;npm packages&lt;/h2&gt;
&lt;p&gt;Beyond the necessary serverless plugins specific to your project,
here are 5 npm packages useful in reproducing a frictionless integration testing
workflow. These packages work together to orchestrate a test run and as such are
co-dependent.&lt;/p&gt;
&lt;h3 id=&#34;wait-on&#34;&gt;&lt;a href=&#34;https://www.npmjs.com/package/wait-on&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;wait-on&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Blocks until a network dependency is satisfied. Useful for wating
for a resource to start up before continuing. In our case, we use it after we have
kicked-off a local aws service via a serverless plugin. We give the command the
local address, when the command returns we know the service has started
successfully and is available.&lt;/p&gt;
&lt;h3 id=&#34;pm2&#34;&gt;&lt;a href=&#34;https://www.npmjs.com/package/pm2&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;pm2&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Process manager used to deamonize locally hosted services.
To reduce friction in our workflow, we don&amp;rsquo;t want to have to juggle multiple
console windows. We&amp;rsquo;re aiming to start the local stack in the background so that
we can continue to run our integration tests in the same console window.&lt;/p&gt;
&lt;h3 id=&#34;npm-run-all&#34;&gt;&lt;a href=&#34;https://www.npmjs.com/package/npm-run-all&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;npm-run-all&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Provides more flexibility in npm script execution. Allows for running multiple
npm script commands in sequence, in parallel or both together. Supports
glob pattern matching for script names, which reduces maintenance as we add more
local service depedencies. Given multiple local services that we
wish to start up, it would be useful to start them in parallel.&lt;/p&gt;
&lt;h3 id=&#34;filename-basepath&#34;&gt;&lt;a href=&#34;https://www.npmjs.com/package/@totallymoney/filename-basepath&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;filename-basepath&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Provides a low-ceremony approach to fulfilling http dependencies. Your project
may not only depend on aws services but also other http endpoints,
perhaps implemented by a third-party. There are several options for hosting mock endpoints,
notably &lt;a href=&#34;https://www.npmjs.com/package/json-server&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;json-server&lt;/a&gt;, but this project,
authored by myself ;-) provides what I think is the right level of control for the
minimum overhead. &lt;code&gt;express.js&lt;/code&gt; routes are provided with custom files. Multiple endpoints
are supported as each route is hosted on a unique basepath.&lt;/p&gt;
&lt;h3 id=&#34;env-cmd&#34;&gt;&lt;a href=&#34;https://www.npmjs.com/package/env-cmd&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;env-cmd&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Starts a process with environment variables provided by a &lt;code&gt;.env&lt;/code&gt; file. Users of
docker-compose will be familiar with this feature that injects settings from a sibling &lt;code&gt;.env&lt;/code&gt;
file into the hosted services. This package replicates that behaviour and is necessary
for the target process under test to know where its depedencies are located. For example,
we need to parameterise the dynamoDB client such that it tries to reach &lt;code&gt;http://localhost:8000&lt;/code&gt;
and not the default aws service url. The same follows for other aws services or mocked http
endpoints.&lt;/p&gt;
&lt;h2 id=&#34;pulling-it-together&#34;&gt;Pulling it together&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;serverless.yml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;plugins&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - serverless-dynamodb-local
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - serverless-s3-local
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;custom&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;s3&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;port&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#b48ead&#34;&gt;7000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;directory&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; s3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;dynamodb&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;start&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;port&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#b48ead&#34;&gt;8000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;migrate&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;inMemory&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;stages&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; local
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;resources&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;Resources&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;DynamoDBTable&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;Type&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; AWS::DynamoDB::Table
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;Properties&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;TableName&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; mytable-${self:provider.stage}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;AttributeDefinitions&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          - &lt;span style=&#34;color:#81a1c1&#34;&gt;AttributeName&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; PK
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#81a1c1&#34;&gt;AttributeType&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; S
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;KeySchema&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          - &lt;span style=&#34;color:#81a1c1&#34;&gt;AttributeName&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; PK
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#81a1c1&#34;&gt;KeyType&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; HASH
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.env&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TABLE&lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;mytable-local
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;S3_URL&lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;http://localhost:7000
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DYNAMODB_URL&lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;http://localhost:8000
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;HTTP_BASE_URL&lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;http://localhost:3000/my-endpoint
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;package.json&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;scripts&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;stop&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;pm2 delete -s all || true&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;start:mocks&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;pm2 start -s filename-basepath -- mocks &amp;amp;&amp;amp; wait-on tcp:3000&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;start:db&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;pm2 start -s --name db sls -- dynamodb start &amp;amp;&amp;amp; wait-on tcp:8000&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;start:s3&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;pm2 start -s --name s3 sls -- s3 start &amp;amp;&amp;amp; wait-on tcp:7000&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;pretest&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;npm-run-all stop --parallel start:*&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;env-cmd dotnet run -p tests&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#eceff4&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;devDependencies&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;@totallymoney/filename-basepath&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;^0.0.4&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;env-cmd&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;^10.1.0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;npm-run-all&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;^4.1.5&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;pm2&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;^4.4.0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;serverless&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;^1.70.0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;serverless-dynamodb-local&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;^0.2.39&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;serverless-s3-local&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;^0.5.4&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;wait-on&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;^4.0.1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#eceff4&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice the usage of the &lt;code&gt;pretest&lt;/code&gt; script. This command is implicitly triggered when &lt;code&gt;test&lt;/code&gt; is called.
Therefore, the following happens when &lt;code&gt;npm run test&lt;/code&gt; is executed:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Stop any existing services &lt;code&gt;pm2&lt;/code&gt; may have already started,
ignoring the error returned if &lt;code&gt;pm2&lt;/code&gt; has no running services.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Start the local stack in parallel and wait for each service to be reachable.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;http endpoints&lt;/li&gt;
&lt;li&gt;dynamodb&lt;/li&gt;
&lt;li&gt;s3&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Run the test suite in the context of the environment variables provided by the &lt;code&gt;.env&lt;/code&gt; file.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;enjoy&#34;&gt;Enjoy!&lt;/h2&gt;
&lt;p&gt;This arrangement is providing value is a number of serverless projects. It has been good reason
to explore the npm ecosytem and successfully reproduces &lt;code&gt;docker-compose&lt;/code&gt; like behaviour.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>A functional wrapper around the .net AWS DynamoDB SDK</title>
      <link>https://blair55.github.io/blog/dynamodb-functional-wrapper/</link>
      <pubDate>Fri, 29 Nov 2019 10:00:00 +0000</pubDate>
      
      <guid>https://blair55.github.io/blog/dynamodb-functional-wrapper/</guid>
      <description>&lt;p&gt;We&amp;rsquo;re going to take a tour of some F# capabilities and
use them to enforce the constraints of the DynamoDB client.
We&amp;rsquo;ll look at domain modeling with discriminated unions,
data access using the reader applicative,
and error handling with the result type.&lt;/p&gt;
&lt;h2 id=&#34;dynamodb-and-data-types&#34;&gt;DynamoDB and Data Types&lt;/h2&gt;
&lt;p&gt;Before we get started, let&amp;rsquo;s summarise DynamoDB and its &lt;a href=&#34;https://docs.aws.amazon.com/en_pv/amazondynamodb/latest/developerguide/HowItWorks.NamingRulesDataTypes.html&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;supported types&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DynamoDB is a key-value &amp;amp; document database.&lt;/li&gt;
&lt;li&gt;DynamoDB tables are schemaless so each record can contain a different number of attributes.&lt;/li&gt;
&lt;li&gt;A record attribute has a string name and a value that is one of three types:
Scalar, Set, and Document.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A &lt;strong&gt;Scalar&lt;/strong&gt; is a single value of a particular primitive type:
string, number, boolean, binary or null.
Number and binary values require string conversion before being sent over the network.&lt;/p&gt;
&lt;p&gt;A &lt;strong&gt;Set&lt;/strong&gt; is a collection of distinct items of the same type.
The set types are string, number, and binary. A set cannot be empty.&lt;/p&gt;
&lt;p&gt;A &lt;strong&gt;Document&lt;/strong&gt; is made from lists and maps.
Lists are non-distinct collections of non-uniform type.
Maps are just like name-value pair json objects and naturally support nesting.
Maps and lists are rich objects because they are compositions of the scalar data types.
Below is an example record.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;Day&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Monday&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;UnreadEmails&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#b48ead&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;ItemsOnMyDesk&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Coffee Cup&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Telephone&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#eceff4&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;Pens&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;Quantity&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#b48ead&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;Pencils&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;Quantity&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#b48ead&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;Erasers&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;#34;Quantity&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#b48ead&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#eceff4&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#eceff4&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;the-write-model&#34;&gt;The Write Model&lt;/h2&gt;
&lt;p&gt;This description of the data types is enough to start building a Write Model.
&lt;strong&gt;We&amp;rsquo;re going to build a layer between our code and the AWS SDK&lt;/strong&gt;,
so let&amp;rsquo;s review the exposed API.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ paket add AWSSDK.DynamoDBv2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;AmazonDynamoDBClient&lt;/code&gt; type exposes a &lt;code&gt;PutItemAsync&lt;/code&gt; method for
writing records to a table.
This method takes two parameters, the target table name as a &lt;code&gt;string&lt;/code&gt; and a &lt;code&gt;Dictionary&amp;lt;string, AttributeValue&amp;gt;&lt;/code&gt; of attributes to write.
The dictionary is what we&amp;rsquo;re interested in building with our model.
Here&amp;rsquo;s an example of directly interfacing with the library to write an item.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;open&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Amazon.DynamoDBv2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;open&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Amazon.DynamoDBv2.Model&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;open&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;System.Collections.Generic&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;use&lt;/span&gt; client &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AmazonDynamoDBClient &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; attributes &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;S &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;foo&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;total&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;N &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;123.45&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;raw&amp;#34;&lt;/span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;B &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;encoded binary value&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; dict
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; Dictionary&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt;AttributeValue&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; response &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; PutItemRequest &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;my_table_name&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; attributes&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; client&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;PutItemAsync
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;AttributeValue&lt;/code&gt; type has a corresponding constructor argument for each type.
The arguments are optional, so it is possible to provide
zero arguments or more than one argument when constructing.
We can improve upon this in our model.
Notice that we provide Number and Boolean values as strings.
We&amp;rsquo;ll perform the conversion when we map our model to Attributes at runtime.&lt;/p&gt;
&lt;h3 id=&#34;building-declaratively&#34;&gt;Building Declaratively&lt;/h3&gt;
&lt;p&gt;We don&amp;rsquo;t want to use the &lt;code&gt;AttributeValue&lt;/code&gt; library type directly because it&amp;rsquo;s cumbersome and error-prone.
We also want to declare our attributes with minimum syntactical ceremony - the F# way!&lt;/p&gt;
&lt;p&gt;To achieve this, we can model the documented type cases with discriminated unions.
Notice that the &lt;code&gt;DocList&lt;/code&gt; case is a recursive type because it references itself,
while the &lt;code&gt;DocMap&lt;/code&gt; case is mutually recursive because it references the &lt;code&gt;Attr&lt;/code&gt; type.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Attr&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; name&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;*&lt;/span&gt; AttrValue
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;and&lt;/span&gt;  AttrValue &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarString &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarDecimal &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;decimal&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarBinary &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarBool &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarNull
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; SetString &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt; Set
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; SetDecimal &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;decimal&lt;/span&gt; Set
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; SetBinary &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt; Set
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; DocList &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; AttrValue &lt;span style=&#34;color:#81a1c1&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; DocMap &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can then build our example document with a collection of &lt;code&gt;Attr&lt;/code&gt;s.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; attributes &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Day&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; ScalarString &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Monday&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;UnreadEmails&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; ScalarDecimal 42m&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;ItemsOnMyDesk&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      DocList
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; ScalarString &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Coffee Cup&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ScalarString &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Telephone&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          DocMap
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Pens&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; DocMap &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Quantity&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; ScalarDecimal 3m&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Pencils&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; DocMap &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Quantity&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; ScalarDecimal 2m&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Erasers&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; DocMap &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Quantity&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; ScalarDecimal 1m&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we need a way to map our &lt;code&gt;Attr list&lt;/code&gt; into the target type:
&lt;code&gt;Dictionary&amp;lt;string,AttributeValue&amp;gt;&lt;/code&gt;.
Notice again the &lt;code&gt;rec&lt;/code&gt; &amp;amp; &lt;code&gt;and&lt;/code&gt; directives are required as the functions are
mutually recursive, reflecting the data structure.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;open&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;System.IO&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;open&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;System.IO.Compression&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; toGzipMemoryStream &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;s&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; output &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; MemoryStream &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;use&lt;/span&gt; zipStream &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; GZipStream &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;output&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;CompressionMode&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;Compress&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;use&lt;/span&gt; writer &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; StreamWriter &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;zipStream&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  writer&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;Write s
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  output
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; rec mapAttrValue &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;function&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarString s  &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;S &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; s&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarDecimal n &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;N &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt; n&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarBinary s  &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;B &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; toGzipMemoryStream s&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarBool b    &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;BOOL &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; b&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; ScalarNull      &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;NULL &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; SetString ss    &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;SS &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; ResizeArray ss&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; SetDecimal ns   &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;NS &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; ResizeArray &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#8fbcbb&#34;&gt;Seq&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt; ns&lt;span style=&#34;color:#81a1c1&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; SetBinary bs    &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;BS &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; ResizeArray &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#8fbcbb&#34;&gt;Seq&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map toGzipMemoryStream bs&lt;span style=&#34;color:#81a1c1&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; DocList l       &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;L &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; ResizeArray &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#8fbcbb&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map mapAttrValue l&lt;span style=&#34;color:#81a1c1&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; DocMap m        &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;M &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; mapAttrsToDictionary m&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;and&lt;/span&gt; mapAttr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;name&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; value&lt;span style=&#34;color:#81a1c1&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  name&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; mapAttrValue value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;and&lt;/span&gt; mapAttrsToDictionary &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#8fbcbb&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map mapAttr &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; dict &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; Dictionary&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt;AttributeValue&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The function below uses our map function before
calling the &lt;code&gt;PutItemAsync&lt;/code&gt; library method.
It then converts the TPL &lt;code&gt;Task&amp;lt;&#39;T&amp;gt;&lt;/code&gt; type into an F# &lt;code&gt;async&lt;/code&gt;
and models the response with the &lt;code&gt;Result&lt;/code&gt; type.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;open&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;System.Net&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; putItem tableName fields &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;list&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Result&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;Unit&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;use&lt;/span&gt; client &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AmazonDynamoDBClient&lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; PutItemRequest &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;tableName&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; mapAttrsToDictionary fields&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; client&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;PutItemAsync
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;AwaitTask
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;RunSynchronously
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; r &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;match&lt;/span&gt; r&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;HttpStatusCode &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;with&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;HttpStatusCode&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;OK &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Ok &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;as&lt;/span&gt; status &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Error &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; sprintf &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Unexpected status code &amp;#39;%A&amp;#39;&amp;#34;&lt;/span&gt; status
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This completes the first half of our journey. Now we can move onto reading an item.&lt;/p&gt;
&lt;h2 id=&#34;the-read-model&#34;&gt;The Read Model&lt;/h2&gt;
&lt;p&gt;DynamoDB provides multiple ways of retrieving data.
We can use &lt;strong&gt;Get&lt;/strong&gt; to retrieve a single item,
and &lt;strong&gt;Query&lt;/strong&gt;, and &lt;strong&gt;Scan&lt;/strong&gt; to return an item collection.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; attributes &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AttributeValue &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;S &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;123&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; dict
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; Dictionary&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt;AttributeValue&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; response &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; GetItemResponse &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; GetItemRequest &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;my_table_name&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; attributes&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; client&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;GetItemAsync
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;AwaitTask
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;RunSynchronously
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; item &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Dictionary&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt;AttributeValue&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  response&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;Item
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;getting-an-item&#34;&gt;Getting an item&lt;/h3&gt;
&lt;p&gt;The DynamoDB library expects a &lt;code&gt;Dictionary&amp;lt;string,AttributeValue&amp;gt;&lt;/code&gt;
to specify the identifier of the single item we wish to retrieve.
This means we can use the write model to provide the identifier.
The item is also returned using the same &lt;code&gt;Dictionary&amp;lt;string,AttributeValue&amp;gt;&lt;/code&gt;.
Our challenge, therefore, is to &lt;strong&gt;turn the Dictionary into our domain type&lt;/strong&gt;.
This sounds like a good fit for the Reader applicative.&lt;/p&gt;
&lt;h3 id=&#34;reader-applicative&#34;&gt;Reader Applicative&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s define a simple domain type that
we want to construct from the &lt;code&gt;GetItemResponse&lt;/code&gt;
Having a function with explicit arguments
will make it easier to build the record
one property at a time.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Order&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; Name &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Description &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    IsVerified &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Quantity &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Cost &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;float&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; buildOrder name desc isVerified qty cost &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; Name &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; name
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Description &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; desc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    IsVerified &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; isVerified
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Quantity &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; qty
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Cost &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; cost &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We&amp;rsquo;re going to combine the work from two articles
to create our &lt;strong&gt;Reader Applicative&lt;/strong&gt; below:
Matthew Podwysocki&amp;rsquo;s
article on the &lt;a href=&#34;http://webcache.googleusercontent.com/search?q=cache:EibmCdF8430J:codebetter.com/matthewpodwysocki/2010/01/07/much-ado-about-monads-reader-edition/&amp;#43;&amp;amp;cd=1&amp;amp;hl=en&amp;amp;ct=clnk&amp;amp;gl=uk&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;Reader Monad&lt;/a&gt; (cached)
and Scott Wlaschin&amp;rsquo;s article that covers
&lt;a href=&#34;https://fsharpforfunandprofit.com/posts/monadster-3/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;applicatives&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;a&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;b&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Reader &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;a &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;b&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; run &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;Reader f&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; a &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    f a
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; retn a &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Reader &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; a&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; map f r &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Reader &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; a &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; run r a &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; f&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; apply f r &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// Reader applicative function
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;&lt;/span&gt;    Reader &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; a &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; run r a &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; run f a&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;Reader&lt;/code&gt; type is completely generic.
It&amp;rsquo;s a single-case union type that contains a simple function: &lt;code&gt;a -&amp;gt; b&lt;/code&gt;.
The &lt;code&gt;Reader&lt;/code&gt; module contains our helper functions.
The &lt;code&gt;run&lt;/code&gt; function is needed to unwrap the reader function,
evaluate it with the provided input &lt;code&gt;a&lt;/code&gt; and return the &lt;code&gt;b&lt;/code&gt;.
&lt;code&gt;run&lt;/code&gt; is the only function in the module that doesn&amp;rsquo;t return a &lt;code&gt;Reader&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;retn&lt;/code&gt; lets us create a &lt;code&gt;Reader&lt;/code&gt; from a single value.
It embeds the value inside a function in which the single argument is ignored.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;map&lt;/code&gt; lets us run a function against the returned value of a reader function.
This is useful when the input value to our function is wrapped inside a &lt;code&gt;Reader&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;apply&lt;/code&gt; takes two &lt;code&gt;Reader&lt;/code&gt; arguments and extracts the values from both by
calling the &lt;code&gt;run&lt;/code&gt; function.
The two extracted values are related.
The first value is a function. The second value is the
first argument to the first extracted function.
We &amp;lsquo;apply&amp;rsquo; the function to the value
and wrap the returned value in a &lt;code&gt;Reader&lt;/code&gt;
This is useful when your function is wrapped inside a &lt;code&gt;Reader&lt;/code&gt;,
and arguments to the function are also wrapped in &lt;code&gt;Reader&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;If we apply our &lt;code&gt;map&lt;/code&gt; function to our &lt;code&gt;buildOrder&lt;/code&gt; function
this is exactly what we get: a multi-argument function wrapped in a reader.
With some helper functions to extract the correct value from the library
&lt;code&gt;Attribute&lt;/code&gt; and some custom operators we can create our record with minimal syntax.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getItem tableName reader fields &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; GetItemRequest &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;tableName&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; mapAttrsToDictionary fields&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; client&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;GetItemAsync
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;AwaitTask
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;RunSynchronously
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; r &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; r&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;Item
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run reader
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&amp;lt;!&amp;gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&amp;lt;*&amp;gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;apply
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; extract f &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;d&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;Dictionary&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt;AttributeValue&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; f d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readString key   &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; extract &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; d &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; d&lt;span style=&#34;color:#81a1c1&#34;&gt;.[&lt;/span&gt;key&lt;span style=&#34;color:#81a1c1&#34;&gt;].&lt;/span&gt;S&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; Reader
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readBool   key   &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; extract &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; d &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; d&lt;span style=&#34;color:#81a1c1&#34;&gt;.[&lt;/span&gt;key&lt;span style=&#34;color:#81a1c1&#34;&gt;].&lt;/span&gt;BOOL&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; Reader
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readNumber key f &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; extract &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; d &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; d&lt;span style=&#34;color:#81a1c1&#34;&gt;.[&lt;/span&gt;key&lt;span style=&#34;color:#81a1c1&#34;&gt;].&lt;/span&gt;N&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; f &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; Reader
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readOrder &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  buildOrder
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;!&amp;gt;&lt;/span&gt; readString &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readString &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readBool   &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;isVerified&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readNumber &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;quantity&amp;#34;&lt;/span&gt; int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readNumber &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;cost&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;float&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getOrder id &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Order &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  getItem &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;orders&amp;#34;&lt;/span&gt; readOrder &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; ScalarString id&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;nested-objects&#34;&gt;Nested Objects&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s extend our example to contain a nested document.
We can see that the reader pattern lets us define functions
that will plug into a parent reader expression.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Merchant&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; Id &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Region &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; buildMerchant id region &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; Id &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; id
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Region &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; region &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readMerchant &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  buildMerchant
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;!&amp;gt;&lt;/span&gt; readNumber &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt; int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readString &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;region&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Order&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; Name &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Description &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    IsVerified &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Merchant &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Merchant &lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// new field
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;&lt;/span&gt;    Quantity &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Cost &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;float&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; buildOrder name desc isVerified merchant qty cost &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; Name &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; name
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Description &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; description
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    IsVerified &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; isVerified
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Merchant &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; merchant
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Quantity &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; qty
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Cost &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; cost &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readOrder &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  buildOrder
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;!&amp;gt;&lt;/span&gt; readString   &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readString   &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readBool     &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;isVerified&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readMerchant &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;merchant&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readNumber   &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;quantity&amp;#34;&lt;/span&gt; int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readNumber   &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;cost&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;float&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;result-reader&#34;&gt;Result Reader&lt;/h3&gt;
&lt;p&gt;In our example, we are reading items from the &lt;code&gt;Dictionary&lt;/code&gt; unsafely.
Let&amp;rsquo;s introduce the &lt;code&gt;Result&lt;/code&gt; type to help us handle errors more gracefully
and provide better for support optional fields on our domain objects.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;ReaderResult&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; retn a &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;Ok a &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; map f &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map f &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; apply f r &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Reader &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; a &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; fa &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run f a
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; fb &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run r a
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;match&lt;/span&gt; fa&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; fb &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;with&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Ok a&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; Ok b &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Ok &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;a b&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Error e&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Error e
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_,&lt;/span&gt; Error e &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Error e
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There is no type definition required as
the &lt;code&gt;map&lt;/code&gt; and &lt;code&gt;apply&lt;/code&gt; functions return a
composed type: &lt;code&gt;Reader&amp;lt;&#39;a,Result&amp;lt;&#39;b,&#39;c&amp;gt;&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Notice that the &lt;code&gt;apply&lt;/code&gt; function
has to pattern patch against two &lt;code&gt;Result&lt;/code&gt;s.
The function inside the first result is
applied to the value inside the second result
provided that both &lt;code&gt;Result&lt;/code&gt;s are &lt;code&gt;Ok&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The helper functions below read from the
&lt;code&gt;GetItemResponse&lt;/code&gt; safely by turning the
contained dictionary into a &lt;code&gt;Map&amp;lt;string,Attribute&amp;gt;&lt;/code&gt;
and using the &lt;code&gt;TryFind&lt;/code&gt; function.
This means we will return an &lt;code&gt;Error&lt;/code&gt; case if we
attempt to read a key from the dictionary that
doesn&amp;rsquo;t exist.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getItem tableName reader fields &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; GetItemRequest &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;tableName&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; mapAttrsToDictionary fields&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; client&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;GetItemAsync
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;AwaitTask
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;RunSynchronously
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; r &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; r&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;Item
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Seq&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map &lt;span style=&#34;color:#81a1c1&#34;&gt;(|&lt;/span&gt;KeyValue&lt;span style=&#34;color:#81a1c1&#34;&gt;|)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Map&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;ofSeq
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Reader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run reader
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; Ok
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; mapFind key &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#8fbcbb&#34;&gt;Map&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;tryFind key
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;function&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Some x &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Ok x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; None &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Error &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; sprintf &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;could not find key %s&amp;#34;&lt;/span&gt; key
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readString key &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Reader &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;mapFind key &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;a&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;AttributeValue&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; a&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;S&lt;span style=&#34;color:#81a1c1&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readStringAs key f &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Reader &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;mapFind key &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;a&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;AttributeValue&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; a&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;S&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;bind f&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readStringAsOption key f &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Reader &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#8fbcbb&#34;&gt;Map&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;tryFind key &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Option&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;a&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;AttributeValue&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; a&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;S&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Option&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;bind f&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readStringSet key &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Reader &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;mapFind key &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;a&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;AttributeValue&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Set&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;ofSeq a&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;SS&lt;span style=&#34;color:#81a1c1&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&amp;lt;!&amp;gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;ResultReader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;map
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&amp;lt;*&amp;gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;ResultReader&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;apply
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; stringToGuid e &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;date&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;String&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  date
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Guid&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;TryParse
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; x &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Ok x &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Error &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;could not parse to guid&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; stringToDate &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;date&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt;String&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  date
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;DateTime&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;TryParse
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;function&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; x &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Some x &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; None
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Order&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; Name &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OrderId &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Guid
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Fulfilled &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; DateTime option
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Tags &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt; Set &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; buildOrder name orderId fulfilled tags &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt; Name &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; name
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OrderId &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; orderId
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Fulfilled &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; fulfilled
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Tags &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; tags &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; readOrder &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  buildOrder
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;!&amp;gt;&lt;/span&gt; readString &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readStringAs &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;orderId&amp;#34;&lt;/span&gt; stringToGuid
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readStringAsOption &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;fulfilled&amp;#34;&lt;/span&gt; stringToDate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;*&amp;gt;&lt;/span&gt; readStringAsSet &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;tags&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getOrder id &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Result&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;Order&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  getItem &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;orders&amp;#34;&lt;/span&gt; readOrder &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt; Attr &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; ScalarString id&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;thats-all&#34;&gt;That&amp;rsquo;s All!&lt;/h2&gt;
&lt;p&gt;We&amp;rsquo;ve only just scratched the surface of the .net library for DynamoDB.
There are plenty more features to model functionally,
including paging, updating and filter expressions.
If you need a feature-complete library then check out
&lt;a href=&#34;https://github.com/fsprojects/FSharp.AWS.DynamoDB&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;FSharp.AWS.DynamoDB&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This article mainly intends to show an example of domain modeling
and the reader applicative, but the green shoots of a new library are visible!&lt;/p&gt;
&lt;p&gt;Happy F# Advent Calendar 2019!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Combining monads</title>
      <link>https://blair55.github.io/blog/combining-monads/</link>
      <pubDate>Fri, 02 Aug 2019 11:36:05 +0100</pubDate>
      
      <guid>https://blair55.github.io/blog/combining-monads/</guid>
      <description>&lt;p&gt;The F# &lt;code&gt;Result&amp;lt;&#39;a,&#39;b&amp;gt;&lt;/code&gt; type allows for concise control flow syntax. The &lt;code&gt;async { ... }&lt;/code&gt; computation expression similarly minimizes the noise of asynchrony. Throw in the &lt;code&gt;Writer&lt;/code&gt; monad for logging minus the intrinsic IO statements. How do you get the benefits of all three together? You need to combine&amp;hellip;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Source code &lt;a href=&#34;https://gist.github.com/blair55/ed415eb479d639f471418f482545fa0e&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;gist&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;writer&#34;&gt;Writer&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;Result&lt;/code&gt; and &lt;code&gt;Async&lt;/code&gt; types are core types in F# but &lt;code&gt;Writer&lt;/code&gt; is not so we need a bit of boilerplate to get going. We define a single case union type in which the single case is parameterized with a function. The function expects a unit and returns a tuple. See &lt;a href=&#34;http://codebetter.com/matthewpodwysocki/2010/02/02/a-kick-in-the-monads-writer-edition/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;this post&lt;/a&gt; for details.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;w&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;t&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Writer &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;unit&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;t &lt;span style=&#34;color:#81a1c1&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;w&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; run&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;w&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;t&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;Writer w&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;t &lt;span style=&#34;color:#81a1c1&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;w&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    w &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;bind&#34;&gt;Bind&lt;/h2&gt;
&lt;p&gt;Now, lets cover the &lt;code&gt;bind&lt;/code&gt; function for each type.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// bind signature
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;// (&amp;#39;a -&amp;gt; Wrapper&amp;lt;&amp;#39;b&amp;gt;) -&amp;gt; &amp;#39;Wrapper&amp;lt;&amp;#39;a&amp;gt; -&amp;gt; Wrapper&amp;lt;&amp;#39;b&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; bind f &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;function&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Ok x &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; f x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Error e &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Error e
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; bind f m &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; f x &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; bind f m &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;x&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs1&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; run m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;y&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs2&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; run &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;f x&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Writer &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; y&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs1 &lt;span style=&#34;color:#81a1c1&#34;&gt;@&lt;/span&gt; logs2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A pattern is present in each of these functions. The signatures are obviously the same but the behaviours can also be generalized. If we were to describe what is going on in general terms we would say:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Unwrap the outer type to reveal the inner value &lt;code&gt;x&lt;/code&gt;. Then, run the given function &lt;code&gt;f&lt;/code&gt; against the value and return the result re-wrapped in the outer type.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There is some subtlety in each to preserve the meaning of the wrapping type. In the &lt;code&gt;Result&lt;/code&gt; case we only want to run the function if the unwrapped value is &lt;code&gt;Ok&lt;/code&gt;. With &lt;code&gt;Async&lt;/code&gt; there is no condition, but &lt;code&gt;return!&lt;/code&gt; must be used to re-wrap the value. The &lt;code&gt;Writer&lt;/code&gt; type requires us to unwrap twice: once to get the initial unwrapped value, then again to get the unwrapped value after applying the function. The logs from both are concatenated in a returned &lt;code&gt;Writer&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;combining&#34;&gt;Combining&lt;/h2&gt;
&lt;p&gt;It seems sensible to order the types as follows:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Async &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt; Writer &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_,&lt;/span&gt; Result &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;Async&lt;/code&gt; type always needs to be on the outside because typically we want to return this type to a framework, something else will be responsible for waiting for the async operation to complete. The middle type should be &lt;code&gt;Writer&lt;/code&gt; because we always want to capture the output. If the &lt;code&gt;Result&lt;/code&gt; and &lt;code&gt;Writer&lt;/code&gt; positions were reversed we would only get the &lt;code&gt;Writer&lt;/code&gt; type back if the &lt;code&gt;Result&lt;/code&gt; type returned an &lt;code&gt;Ok&lt;/code&gt; case, which is undesirable.&lt;/p&gt;
&lt;h3 id=&#34;the-first-two&#34;&gt;The First Two&lt;/h3&gt;
&lt;p&gt;Let&amp;rsquo;s combine just the middle two types and work our way up to three. I&amp;rsquo;ve found it useful to have the inner types combined as some workflows turn out not to be asynchronous and can easily be made so using &lt;code&gt;Async.map&lt;/code&gt; to fit with other workflows.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;WriterResult&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; bind f m &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs1&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;match&lt;/span&gt; r &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;with&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Ok a &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;b&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs2&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;f a&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Writer &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; b&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs1 &lt;span style=&#34;color:#81a1c1&#34;&gt;@&lt;/span&gt; logs2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Error e &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Writer &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Error e&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice the signature of this function is exactly the same as the for the singular wrapping cases above. The generic types &lt;code&gt;&#39;a&lt;/code&gt; and &lt;code&gt;&#39;b&lt;/code&gt; are now a bit more embellished. Even the description of the function still applies. There is just now a bit more going on in order to &amp;lsquo;unwrap&amp;rsquo; the inner value.&lt;/p&gt;
&lt;p&gt;When handling combined types, we have to &amp;lsquo;unwrap&amp;rsquo; according to the order of the types. Our type here is &lt;code&gt;WriterResult&lt;/code&gt;, meaning that &lt;code&gt;Writer&lt;/code&gt; wraps &lt;code&gt;Result&lt;/code&gt;. We therefore need to unwrap &lt;code&gt;Writer&lt;/code&gt; before unwrapping &lt;code&gt;Result&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So our first step is to unwrap the &lt;code&gt;Writer&lt;/code&gt;, revealing any written logs and a &lt;code&gt;Result&lt;/code&gt;. Now, we can unwrap the &lt;code&gt;Result&lt;/code&gt; to get to our inner value. If this value is &lt;code&gt;Ok&lt;/code&gt; we preserve the meaning of &lt;code&gt;Result&lt;/code&gt; by continuing to apply our function &lt;code&gt;f&lt;/code&gt; to the inner value. However, &lt;code&gt;f&lt;/code&gt; is a function that returns &lt;code&gt;Writer&lt;/code&gt;, so we must unwrap that too to get another value and some more logs. This second value the result type that we want to return, along with all the logs. We therefore wrap in up in a new &lt;code&gt;Writer&lt;/code&gt; with the concatenated logs.&lt;/p&gt;
&lt;p&gt;If the first &lt;code&gt;Result&lt;/code&gt; we encountered by unwrapping our writer turned out to be the &lt;code&gt;Error&lt;/code&gt; case then we return this &lt;code&gt;Error&lt;/code&gt; wrapped in a &lt;code&gt;Writer&lt;/code&gt; without using &lt;code&gt;f&lt;/code&gt; at all.&lt;/p&gt;
&lt;h3 id=&#34;all-three&#34;&gt;All Three&lt;/h3&gt;
&lt;p&gt;The same wrapping and unwrapping technique applies when adding a third outer type. We simply have to accommodate the correct order of the types. Again, the signature and description do not change as the meaning of &lt;code&gt;bind&lt;/code&gt; is consistent no matter how many outer types there are.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;AsyncWriterResult&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; bind f m &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; w1 &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs1&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run w1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;match&lt;/span&gt; r &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;with&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Ok a &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; w2 &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; f a
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;b&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs2&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run w2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; Writer &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; b&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs1 &lt;span style=&#34;color:#81a1c1&#34;&gt;@&lt;/span&gt; logs2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;|&lt;/span&gt; Error e &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; Writer &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; Error e&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs1 &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This looks very similar to the &lt;code&gt;WriterResult&lt;/code&gt; type. The difference is obviously the reference to the &lt;code&gt;async&lt;/code&gt; computation expression. This is needed to unwrap in the correct order. We start with unwrapping the &lt;code&gt;Async&lt;/code&gt; type using &lt;code&gt;let!&lt;/code&gt; to reveal a &lt;code&gt;WriterResult&lt;/code&gt;. This then needs to be unwrapped to reveal a &lt;code&gt;Result&lt;/code&gt; and some logs. If the &lt;code&gt;Result&lt;/code&gt; is &lt;code&gt;Ok&lt;/code&gt; we can apply our function and which gives us an &lt;code&gt;AsyncWriterResult&lt;/code&gt;. We have to again unwrap with &lt;code&gt;let!&lt;/code&gt; to get a &lt;code&gt;WriterResult&lt;/code&gt;. We unwrap the &lt;code&gt;WriterResult&lt;/code&gt; leaving us just a &lt;code&gt;Result&lt;/code&gt; and some more logs. The &lt;code&gt;Result&lt;/code&gt; is returned in a new &lt;code&gt;Writer&lt;/code&gt; with the concatenated logs using the &lt;code&gt;return&lt;/code&gt; statement to wrap in an &lt;code&gt;Async&lt;/code&gt;. As before, if the inner &lt;code&gt;Result&lt;/code&gt; is an &lt;code&gt;Error&lt;/code&gt; case we do not want to apply &lt;code&gt;f&lt;/code&gt; and exit early.&lt;/p&gt;
&lt;h2 id=&#34;return&#34;&gt;Return&lt;/h2&gt;
&lt;p&gt;Before we can examine a use case for this we need to provide an implementation of &lt;code&gt;return&lt;/code&gt;. This function is required before we can use a computation expression. Notice again how the order is important in wrapping the value.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; retn x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Ok x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; retn x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; x &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; retn x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Writer &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; x&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;AsyncWriterResult&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; retn x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn x &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Builder&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;AsyncWriterResultBuilder&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;member&lt;/span&gt; __&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#88c0d0&#34;&gt;Return&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;x&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;AsyncWriterResult&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;member&lt;/span&gt; __&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#88c0d0&#34;&gt;ReturnFrom&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#81a1c1&#34;&gt;:&lt;/span&gt; Async&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;Writer&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;a&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; Result&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;b&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;&amp;#39;&lt;/span&gt;c&lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&amp;gt;&amp;gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;member&lt;/span&gt; __&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#88c0d0&#34;&gt;Bind&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;m&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; f&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;AsyncWriterResult&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;bind f m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; asyncWriterResult &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;new&lt;/span&gt; AsyncWriterResultBuilder &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;writing&#34;&gt;Writing&lt;/h3&gt;
&lt;p&gt;Now we have our computation expression defined we need one more thing. A handy write function that lets us write logs when required. Notice again how we are wrapping in the corrrect order. The &lt;code&gt;write&lt;/code&gt; function implicitly returns &lt;code&gt;unit&lt;/code&gt; type, and will be used with the &lt;code&gt;do!&lt;/code&gt; directive.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;module&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;AsyncWriterResult&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; write log &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; Writer &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt;log&lt;span style=&#34;color:#81a1c1&#34;&gt;])&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;in-practice&#34;&gt;In Practice&lt;/h2&gt;
&lt;p&gt;Lets define some bindable functions and compose them in a &lt;code&gt;AsyncWriterResult&lt;/code&gt; computation expression.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; getThing x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;do&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;Sleep 100
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn x &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn  &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; checkThing r &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;if&lt;/span&gt; r &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;gt;&lt;/span&gt; 0 &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;then&lt;/span&gt; Ok &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;thing is ok&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;else&lt;/span&gt; Error &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;thing is bad&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; expr x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; asyncWriterResult &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;do&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; write &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;getting thing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; thing &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; getThing x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;do&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; write &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;checking thing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; result &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; checkThing thing
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;do&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; write &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;returning thing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; result &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; eval x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  expr 0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;RunSynchronously
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice the difference in output for each call below. The logs accumulate only as far the &lt;code&gt;Result&lt;/code&gt; remains &lt;code&gt;Ok&lt;/code&gt;. This shows we have preserved the meaning of the &lt;code&gt;Result&lt;/code&gt; type while successfully adding &lt;code&gt;Writer&lt;/code&gt; and &lt;code&gt;Async&lt;/code&gt; layers.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt; eval 0;;
val it : Result&amp;lt;string,string&amp;gt; * string list =
  (Error &amp;#34;thing is bad&amp;#34;, [&amp;#34;getting thing&amp;#34;; &amp;#34;checking thing&amp;#34;])

&amp;gt; eval 1;;
val it : Result&amp;lt;string,string&amp;gt; * string list =
  (Ok &amp;#34;thing is ok&amp;#34;, [&amp;#34;getting thing&amp;#34;; &amp;#34;checking thing&amp;#34;; &amp;#34;returning thing&amp;#34;])
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;discussion&#34;&gt;Discussion&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;WriterResult&lt;/code&gt; and &lt;code&gt;AsyncWriterResult&lt;/code&gt; types implicitly return on the &lt;a href=&#34;https://fsharpforfunandprofit.com/posts/recipe-part2/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;error track&lt;/a&gt; when an &lt;code&gt;Error&lt;/code&gt; case is encountered meaning any &lt;code&gt;do!&lt;/code&gt; log will not be evaluated after any &lt;code&gt;let!&lt;/code&gt; that returns an &lt;code&gt;Error&lt;/code&gt;. As demonstrated above. But what if you &lt;em&gt;do&lt;/em&gt; want to log after receiving an &lt;code&gt;Error&lt;/code&gt;?&lt;/p&gt;
&lt;p&gt;Lets say we want to log the duration of a function call that returns a &lt;code&gt;AsyncWriterResult&lt;/code&gt;. We can only know the elapsed time after the function has completed. However, if the function results in an &lt;code&gt;Error&lt;/code&gt; we don&amp;rsquo;t have the opportunity to stop the clock or write the log!&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;measure&lt;/code&gt; function below can help us out. By unwrapping the outer &lt;code&gt;Async&lt;/code&gt; type by invoking the function with a &lt;code&gt;unit&lt;/code&gt; we have a &lt;code&gt;WriterResult&lt;/code&gt;. We run this to get at our inner &lt;code&gt;Result&lt;/code&gt; and any logs written. We don&amp;rsquo;t care which case our &lt;code&gt;Result&lt;/code&gt; is because we want to write the elapsed time in either case. We can just bundle up our &lt;code&gt;Result&lt;/code&gt; with the concatenated logs in a new &lt;code&gt;Writer&lt;/code&gt; and using &lt;code&gt;return!&lt;/code&gt; because we have a fully formed &lt;code&gt;AsyncWriterResult&lt;/code&gt; already at the end of the expression.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; measure name f &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; asyncWriterResult &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; sw &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Stopwatch&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;StartNew &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; w &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; f &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; logs&lt;span style=&#34;color:#81a1c1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;run w
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; log &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; sprintf &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;%s: %i&amp;#34;&lt;/span&gt; name sw&lt;span style=&#34;color:#81a1c1&#34;&gt;.&lt;/span&gt;ElapsedMilliseconds
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; Writer &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; r&lt;span style=&#34;color:#81a1c1&#34;&gt;,&lt;/span&gt; log &lt;span style=&#34;color:#81a1c1&#34;&gt;::&lt;/span&gt; logs &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; failToGetThing x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; async &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;do&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Async&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;Sleep 100
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; Error &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;could not get thing&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#8fbcbb&#34;&gt;Writer&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;retn  &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; expr x &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; asyncWriterResult &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;do&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; write &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;getting thing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let!&lt;/span&gt; thing &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt; measure &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;elapsed&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;&amp;lt;|&lt;/span&gt; &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;fun&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;-&amp;gt;&lt;/span&gt; failToGetThing x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;do&lt;/span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;!&lt;/span&gt; write &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;returning thing&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;return&lt;/span&gt; thing &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now the output includes the &lt;code&gt;elapsed&lt;/code&gt; log despite resulting in an &lt;code&gt;Error&lt;/code&gt;.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt; eval 1;;
val it : Result&amp;lt;string,string&amp;gt; * string list =
  (Error &amp;#34;could not get thing&amp;#34;, [&amp;#34;getting thing&amp;#34;; &amp;#34;elapsed: 105&amp;#34;])
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Serverless package done right</title>
      <link>https://blair55.github.io/blog/serverless-package-done-right/</link>
      <pubDate>Mon, 01 Apr 2019 11:36:05 +0100</pubDate>
      
      <guid>https://blair55.github.io/blog/serverless-package-done-right/</guid>
      <description>&lt;h2 id=&#34;problem&#34;&gt;Problem&lt;/h2&gt;
&lt;p&gt;The Severless Framework &lt;a href=&#34;https://serverless.com/framework/docs/providers/aws/guide/packaging/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;package command&lt;/a&gt; claims to be useful in CI/CD workflows. The command results in the production of AWS Cloud Formation stack json files (or alternative cloud provider equivalent) on disk. These files can be bundled and considered the &amp;lsquo;deployment artifact&amp;rsquo; at the end of the pipeline. The artifact can be provided to the &lt;code&gt;serverless deploy&lt;/code&gt; command that could be run at a later date.&lt;/p&gt;
&lt;p&gt;This two-step package/deploy process is very familiar, so I was lured into using the &lt;code&gt;serverless package&lt;/code&gt; command. However, there is a major flaw in the design!&lt;/p&gt;
&lt;p&gt;The behaviour of the command is to &amp;lsquo;bake in&amp;rsquo; the value of the expected environment variables or &lt;a href=&#34;https://aws.amazon.com/systems-manager/features/#Parameter_Store&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;AWS Parameter Store&lt;/a&gt; keys. This means your artifacts are not environment-agnostic. For example, if you include the stage parameter in the name of any functions or resources then the value of the stage parameter will be hardcoded in the artifacts. You therefore cannot promote these artifacts to any stage other than the one named when &lt;code&gt;serverless package&lt;/code&gt; was called.&lt;/p&gt;
&lt;h2 id=&#34;environment-agnostic&#34;&gt;Environment Agnostic&lt;/h2&gt;
&lt;p&gt;Build artifacts are supposed to be environment-agnostic. You should be able to deploy your artifacts to any environment and &amp;lsquo;promote&amp;rsquo; through to production if desired. Artifacts must therefore be parameterised such that the target environment can provide everything the application needs. This is done using &lt;a href=&#34;https://12factor.net/config&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;environment variables&lt;/a&gt;. The only &amp;lsquo;static&amp;rsquo; value in the artifact should be the version number, provided at build time.&lt;/p&gt;
&lt;p&gt;One option to side-step this problem is to perform the package step once per potential target environment. A deployment would require the versioned artifacts for the target environment. This option is cumbersome during the build phase and complicates the deploy phase. However, the main problem is the potential for the baked-in environment variables to become stale.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s say we change the value of an environment variable after packaging for the production environment. This would require all the existing production-targeted artifacts to be rebuilt so as to bake-in the latest value. Only then are the new packages fit to be deployed. This creates CI overhead and requires consideration of how far back through artifact version history is sensible to rebuild.&lt;/p&gt;
&lt;h2 id=&#34;just-in-time-packaging&#34;&gt;Just-in-time Packaging&lt;/h2&gt;
&lt;p&gt;The only realistic option is to postpone the package step, i.e. don&amp;rsquo;t call &lt;code&gt;serverless package&lt;/code&gt; explicitly. The package command is implicitly called within the deploy command (as long as the &lt;code&gt;--package&lt;/code&gt; parameter is not provided). This package command deference is what happens when you call &lt;code&gt;serverless deploy&lt;/code&gt; against your serverless.yml. The environment variables are baked-in &amp;lsquo;just-in-time&amp;rsquo; so the artifacts are fit for the target environment.&lt;/p&gt;
&lt;p&gt;We need to bring just-in-time packaging to CI to produce environment-agnostic build artifacts. The solution is to neglect the &lt;code&gt;serverless package&lt;/code&gt; command and include the serverless.yml file into the build artifact. The deployment tooling must then execute the &lt;code&gt;serverless deploy&lt;/code&gt; command against the serverless.yml from within the artifact sometime later.&lt;/p&gt;
&lt;p&gt;To make the bundle completely self-contained the &lt;code&gt;package.json&lt;/code&gt; file is also required alongside the serverless.yml. You could include your node_modules folder, or simply your &lt;code&gt;package-lock.json&lt;/code&gt; or &lt;code&gt;yarn.lock&lt;/code&gt; file and include a call to restore packages before &lt;code&gt;serverless deploy&lt;/code&gt; is called, as shown below:&lt;/p&gt;
&lt;p&gt;Build artifact contents&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ tree ./deploy
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; package.json
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; package.zip &lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;# code bundle&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; serverless.yml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; yarn.lock
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Serverless.yml package snippet&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;package&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#81a1c1&#34;&gt;artifact&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;:&lt;/span&gt; package.zip
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Deployment steps&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ &lt;span style=&#34;color:#81a1c1&#34;&gt;cd&lt;/span&gt; ./deploy
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ yarn install
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ yarn run serverless deploy --stage prod
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Squash Git Commits</title>
      <link>https://blair55.github.io/blog/squash-git-commits/</link>
      <pubDate>Tue, 16 Oct 2018 10:36:05 +0100</pubDate>
      
      <guid>https://blair55.github.io/blog/squash-git-commits/</guid>
      <description>&lt;p&gt;Ever made several commits on a feature branch and needed to rebase? Rebasing multiple commits can be tedious if there is a conflict from an early commit, requiring a commit resolution in every commit that follows. It can be practical, therefore, to squash multiple commits into a single commit before rebasing.&lt;/p&gt;
&lt;p&gt;Ever wanted to clean up your commit history before pushing? I often make quick commits if I&amp;rsquo;m required to switch branches, or spiking an idea during development that ends up being permanent. I&amp;rsquo;m left with messy commit messages that rarely follow &lt;a href=&#34;https://chris.beams.io/posts/git-commit/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;best practice&lt;/a&gt;. Squashing commits to the rescue again! I can then take the time to carefully construct a commit message.&lt;/p&gt;
&lt;p&gt;I will be using the oh-my-zsh aliases in this example below&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Required: Z-Shell &amp;amp; &lt;a href=&#34;https://ohmyz.sh/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;oh-my-zsh&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ glo
5fe9acf97 done
5306d9b9f Vevert &amp;#39;try out a fix&amp;#39;
da1341005 more wip
ef8bb3f49 try out a fix
471bd09c1 wip
895143a59 start the work
2b2a51e70 (HEAD -&amp;gt; master, origin/master, origin/HEAD) Refactor layout
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As you can see, the commit history is a mess. Let&amp;rsquo;s squash all the commits since the &lt;em&gt;head&lt;/em&gt; of local master into one commit.&lt;/p&gt;
&lt;p&gt;First, reset your work to the commit before your work started, identified by the hash.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ git reset 2b2a51e70
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Notice your changes are still on disk but git only sees them as unstaged changes - your ugly commits have disappeared.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ gst
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now we can commit with a more thoughtful commit message.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ gaa
$ gcam &amp;#34;Add feature x...&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now we&amp;rsquo;re in a position to rebase as the impact of a potential conflict has been reduced. Update your local copy of all remote branches and rebase on master.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ gfo
$ grb origin/master
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Resolve any conflicts using your editor then continue the rebase.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ gaa
$ grbc
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Confirm the history is as you expect, then push!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ gst
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ gp -f &lt;span style=&#34;color:#616e87;font-style:italic&#34;&gt;# or use gpsup if the branch has not been pushed before&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;For a list of aliases, simply use the command: &lt;code&gt;alias&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Scripting with AWS Parameter Store</title>
      <link>https://blair55.github.io/blog/aws-parameter-store-scripting/</link>
      <pubDate>Fri, 12 Oct 2018 16:35:01 +0100</pubDate>
      
      <guid>https://blair55.github.io/blog/aws-parameter-store-scripting/</guid>
      <description>&lt;p&gt;Ever need to write a short script as part of development to get feedback on a portion of code? Ever need to add private authentication values to that script? Ever wanted to add the script to source control but couldn&amp;rsquo;t because it contained your private authentication?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Enter: AWS Parameter Store&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This AWS service acts as a key-value store. Add your private settings such as usernames, passwords, connection strings etc and they can be retrieved programatically by their key name. This lets you commit your handy script to source control by keeping it free from private values.&lt;/p&gt;
&lt;h2 id=&#34;example&#34;&gt;Example&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Required: Your own AWS Account and the &lt;a href=&#34;https://docs.aws.amazon.com/cli/latest/reference/ssm&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;AWS CLI&lt;/a&gt; installed and configured. Make sure the aws output type configuration is json.
Required: &lt;a href=&#34;https://stedolan.github.io/jq/manual/&#34;target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34;&gt;jq&lt;/a&gt; cli&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Add a parameter to the store using the AWS CLI&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ aws ssm put-parameter --name &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;authtoken&amp;#34;&lt;/span&gt; --type &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;String&amp;#34;&lt;/span&gt; --value &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;foobar&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Query the parameter store with the key name&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ aws ssm get-parameter --name &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;authtoken&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Parameter&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Version&amp;#34;&lt;/span&gt;: 1,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;String&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;authtoken&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;foobar&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice the output is in json format. To isolate the parameter value we can pipe the response into a jq expression:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ aws ssm put-parameter --name &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;authtoken&amp;#34;&lt;/span&gt; --type &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;String&amp;#34;&lt;/span&gt; --value &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;foobar&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;|&lt;/span&gt; jq -r .Parameter.Value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt; foobar
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Armed with this command we can create a script that is absent of hard-coded private values.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;get_param&lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    P&lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;$(&lt;/span&gt;aws ssm get-parameter --name &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;&lt;/span&gt;$1&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;|&lt;/span&gt; jq -r &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#39;.Parameter.Value&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;&lt;/span&gt;$P&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AUTH_TOKEN&lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;$(&lt;/span&gt;get_param &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;authtoken&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;echo&lt;/span&gt; AUTH_TOKEN
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;taking-it-further&#34;&gt;Taking it Further&lt;/h2&gt;
&lt;p&gt;Ever needed to write a script using a general purpose language?&lt;/p&gt;
&lt;p&gt;In a recent example, I needed to execute a script written in F#. The script required private values from the parameter store.&lt;/p&gt;
&lt;p&gt;I simply extended the original script to populate environment variables followed by a call to invoke the F# script.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;get_param&lt;span style=&#34;color:#81a1c1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    P&lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;$(&lt;/span&gt;aws ssm get-parameter --name &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;&lt;/span&gt;$1&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#eceff4&#34;&gt;|&lt;/span&gt; jq -r &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#39;.Parameter.Value&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;&lt;/span&gt;$P&lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AUTH_TOKEN&lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;$(&lt;/span&gt;get_param &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;authtoken&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#ebcb8b&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ebcb8b&#34;&gt;&lt;/span&gt;BASE_URL&lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;$(&lt;/span&gt;get_param &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;baseurl&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#ebcb8b&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ebcb8b&#34;&gt;&lt;/span&gt;fsharpi script.fsx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fsharp&#34; data-lang=&#34;fsharp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; env &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8fbcbb&#34;&gt;System&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#8fbcbb&#34;&gt;Environment&lt;/span&gt;&lt;span style=&#34;color:#eceff4&#34;&gt;.&lt;/span&gt;GetEnvironmentVariable
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1;font-weight:bold&#34;&gt;let&lt;/span&gt; log &lt;span style=&#34;color:#81a1c1&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    printfn &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;%s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;env &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;AUTH_TOKEN&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;env &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;BASE_URL&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;|&amp;gt;&lt;/span&gt; log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;path-support&#34;&gt;Path Support&lt;/h2&gt;
&lt;p&gt;Ever needed to get a collection of parameters?&lt;/p&gt;
&lt;p&gt;AWS Parameter Store key names can be provided as a path. This allows you to group parameters logically, for example by system or environment, or both.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ aws ssm put-parameter --name &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;/production/authtoken&amp;#34;&lt;/span&gt; --type &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;String&amp;#34;&lt;/span&gt; --value &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;foobar&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ aws ssm put-parameter --name &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;/production/baseurl&amp;#34;&lt;/span&gt; --type &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;String&amp;#34;&lt;/span&gt; --value &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;www.example.url&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Parameters can then be fetched by path. Meaning your production system can retrieve all the keys under the production path.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ aws ssm get-parameters-by-path --path &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;/production&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt; &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Parameters&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#81a1c1&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Version&amp;#34;&lt;/span&gt;: 1,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;String&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;/production/authtoken&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;foobar&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Version&amp;#34;&lt;/span&gt;: 1,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Type&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;String&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;/production/baseurl&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;Value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a3be8c&#34;&gt;&amp;#34;www.example.url&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#81a1c1&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#81a1c1&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Note the output is a collection of parameters.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>